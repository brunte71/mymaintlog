# fly.toml – Fly.io deployment configuration for ServiceMgr
# Docs: https://fly.io/docs/reference/configuration/
#
# This configuration targets up to ~20 concurrent users ($0/month, free tier).
# For larger deployments, see CLOUD_HOSTING.md "Scaling analysis by user count":
#
#   ~50 users   → memory = "512mb", min_machines_running = 1          (~$3–4/month)
#   ~100 users  → memory = "1gb",   min_machines_running = 1          (~$6–9/month)
#   ~500 users  → size = "shared-cpu-2x", memory = "4gb"              (~$24–27/month)
#   ~1000 users → size = "shared-cpu-4x", memory = "8gb" + Fly Postgres (~$48–55/month)
#
# Fly.io pricing reference (2025):
#   shared-cpu-1x  256 MB  $1.94/month  (covered by free allowance – 3 machines free)
#   shared-cpu-1x  512 MB  $3.19/month
#   shared-cpu-1x    1 GB  $5.70/month
#   shared-cpu-2x    4 GB  $21.40/month
#   shared-cpu-4x    8 GB  $42.79/month
#   Persistent volume      $0.15/GB/month (first 3 GB free per org)
#   Outbound bandwidth     $0.02/GB       (first 160 GB/month free per org)

app = "servicemgr"          # Change to your unique Fly.io app name
primary_region = "ams"      # Amsterdam – pick the region closest to your users

[build]
  dockerfile = "Dockerfile"

# The persistent volume is mounted at /app/data so the SQLite database and
# uploaded photos survive container restarts and re-deployments.
[mounts]
  source      = "servicemgr_data"   # volume name (created once with `fly volumes create`)
  destination = "/app/data"

[http_service]
  internal_port        = 8501
  force_https          = true
  auto_stop_machines   = true   # stop when idle to stay within free tier
  auto_start_machines  = true
  min_machines_running = 0      # 0 = scale to zero; set to 1 for always-on

[[vm]]
  size   = "shared-cpu-1x"
  memory = "256mb"
